CREATE OR REPLACE FUNCTION tgabm00.e3rps174(
	IN_CMPGN_ID CHAR(25),
	IN_CMPGN_NM CHAR(100),
	IN_CMPGN_STRT_DT DATE,
	IN_CMPGN_END_DT DATE,
	IN_FETCH_IND CHAR(10)
) RETURNS TABLE (
	SQLCODE_PARM CHAR(10),
	RESP_CD CHAR(14),
	RESP_MSG CHAR(100),
	CMPGN_ID CHAR(25),
	CMPGN_NM CHAR(100),
	CMPGN_DS TEXT,
	CMPGN_PROMO_CD CHAR(10),
	CMPGN_STA_TX TEXT,
	CREAT_TS TIMESTAMP,
	LST_UPDT_TS TIMESTAMP,
	CMPGN_CONTEST_MAX_ENTER_CT INTEGER,
	CMPGN_TRGT_REGIS_CT INTEGER,
	BUS_PRTR_DRCT_OWN_NM TEXT,
	CMPGN_STRT_DT DATE,
	CMPGN_END_DT DATE,
	DA_PRG_DT DATE,
	CREAT_BY_USER_TYPE_TX TEXT,
	UPDT_BY_USER_TYPE_TX TEXT,
	ENROLL_SUC_EMAIL_SEND_IN CHAR(1),
	ENROLL_SUC_EMAIL_TMPLT_ID CHAR(10),
	ENROLL_STA_EMAIL_SEND_IN CHAR(1),
	ENROLL_STA_EMAIL_TMPLT_ID CHAR(10),
	CMPGN_IM_URL_AD_TX TEXT,
	EMS_EXTNL_PROMO_ID CHAR(10),
	EMS_EXTNL_PRTR_ID CHAR(10),
	CMPGN_LIVE_DT DATE
) AS $$
DECLARE
	SQLCODE CHAR(10);
	HV_CMPGN_NM VARCHAR(100);
	HV_CMPGN_NM1 VARCHAR(100);
BEGIN
	SQLCODE_PARM := '';
	RESP_CD := '';
	RESP_MSG := '';

	IF IN_FETCH_IND = 'CMPGNID' THEN
		BEGIN
			SQLCODE := '0';
			RESP_CD := 'E35174001';
			RESP_MSG := 'CMPGN ID DETAIL FETCH SUCCESSFULLY.';
			SQLCODE_PARM := SQLCODE;
			RETURN QUERY
			SELECT SQLCODE_PARM, RESP_CD, RESP_MSG, CMPGN_ID, CMPGN_NM, CMPGN_DS, CMPGN_PROMO_CD, CMPGN_STA_TX,
				   CREAT_TS, LST_UPDT_TS, CMPGN_CONTEST_MAX_ENTER_CT,
				   CMPGN_TRGT_REGIS_CT, BUS_PRTR_DRCT_OWN_NM, CMPGN_STRT_DT,
				   CMPGN_END_DT, DA_PRG_DT, CREAT_BY_USER_TYPE_TX,
				   UPDT_BY_USER_TYPE_TX, ENROLL_SUC_EMAIL_SEND_IN,
				   ENROLL_SUC_EMAIL_TMPLT_ID, ENROLL_STA_EMAIL_SEND_IN,
				   ENROLL_STA_EMAIL_TMPLT_ID, CMPGN_IM_URL_AD_TX,
				   EMS_EXTNL_PROMO_ID, EMS_EXTNL_PRTR_ID, CMPGN_LIVE_DT
			FROM tgabm00.GABM_CMPGN
			WHERE CMPGN_ID = IN_CMPGN_ID;
		EXCEPTION
			WHEN OTHERS THEN
				SQLCODE := SQLSTATE;
				RESP_CD := 'E35174901';
				RESP_MSG := 'THE SYSTEM CANNOT PROCESS YOUR REQUEST. PLEASE TRY AFTER SOME TIME.';
				SQLCODE_PARM := SQLCODE;
				RETURN QUERY SELECT SQLCODE_PARM, RESP_CD, RESP_MSG, NULL::CHAR(25), NULL::CHAR(100), NULL::TEXT, NULL::CHAR(10), NULL::TEXT, NULL::TIMESTAMP, NULL::TIMESTAMP, NULL::INTEGER, NULL::INTEGER, NULL::TEXT, NULL::DATE, NULL::DATE, NULL::DATE, NULL::TEXT, NULL::TEXT, NULL::CHAR(1), NULL::CHAR(10), NULL::CHAR(1), NULL::CHAR(10), NULL::TEXT, NULL::CHAR(10), NULL::CHAR(10), NULL::DATE;
		END;
	ELSIF IN_FETCH_IND = 'CMPGNNM' THEN
		HV_CMPGN_NM := '%' || TRIM(LEADING FROM IN_CMPGN_NM);
		HV_CMPGN_NM1 := TRIM(TRAILING FROM HV_CMPGN_NM) || '%';

		BEGIN
			SQLCODE := '0';
			RESP_CD := 'E35174002';
			RESP_MSG := 'CMPGN NM DETAIL FETCH SUCCESSFULLY.';
			SQLCODE_PARM := SQLCODE;
			RETURN QUERY
			SELECT SQLCODE_PARM, RESP_CD, RESP_MSG, CMPGN_ID, CMPGN_NM, CMPGN_DS, CMPGN_PROMO_CD, CMPGN_STA_TX,
				   CREAT_TS, LST_UPDT_TS, CMPGN_CONTEST_MAX_ENTER_CT,
				   CMPGN_TRGT_REGIS_CT, BUS_PRTR_DRCT_OWN_NM, CMPGN_STRT_DT,
				   CMPGN_END_DT, DA_PRG_DT, CREAT_BY_USER_TYPE_TX,
				   UPDT_BY_USER_TYPE_TX, ENROLL_SUC_EMAIL_SEND_IN,
				   ENROLL_SUC_EMAIL_TMPLT_ID, ENROLL_STA_EMAIL_SEND_IN,
				   ENROLL_STA_EMAIL_TMPLT_ID, CMPGN_IM_URL_AD_TX,
				   EMS_EXTNL_PROMO_ID, EMS_EXTNL_PRTR_ID, CMPGN_LIVE_DT
			FROM tgabm00.GABM_CMPGN
			WHERE UPPER(CMPGN_NM) LIKE UPPER(HV_CMPGN_NM1);
		EXCEPTION
			WHEN OTHERS THEN
				SQLCODE := SQLSTATE;
				RESP_CD := 'E35174902';
				RESP_MSG := 'THE SYSTEM CANNOT PROCESS YOUR REQUEST. PLEASE TRY AFTER SOME TIME.';
				SQLCODE_PARM := SQLCODE;
				RETURN QUERY SELECT SQLCODE_PARM, RESP_CD, RESP_MSG, NULL::CHAR(25), NULL::CHAR(100), NULL::TEXT, NULL::CHAR(10), NULL::TEXT, NULL::TIMESTAMP, NULL::TIMESTAMP, NULL::INTEGER, NULL::INTEGER, NULL::TEXT, NULL::DATE, NULL::DATE, NULL::DATE, NULL::TEXT, NULL::TEXT, NULL::CHAR(1), NULL::CHAR(10), NULL::CHAR(1), NULL::CHAR(10), NULL::TEXT, NULL::CHAR(10), NULL::CHAR(10), NULL::DATE;
		END;
	ELSIF IN_FETCH_IND = 'CMPGNDT' THEN
		BEGIN
			SQLCODE := '0';
			RESP_CD := 'E35174003';
			RESP_MSG := 'CMPGN DETAIL FETCH SUCCESSFULLY.';
			SQLCODE_PARM := SQLCODE;
			RETURN QUERY
			SELECT SQLCODE_PARM, RESP_CD, RESP_MSG, CMPGN_ID, CMPGN_NM, CMPGN_DS, CMPGN_PROMO_CD, CMPGN_STA_TX,
				   CREAT_TS, LST_UPDT_TS, CMPGN_CONTEST_MAX_ENTER_CT,
				   CMPGN_TRGT_REGIS_CT, BUS_PRTR_DRCT_OWN_NM, CMPGN_STRT_DT,
				   CMPGN_END_DT, DA_PRG_DT, CREAT_BY_USER_TYPE_TX,
				   UPDT_BY_USER_TYPE_TX, ENROLL_SUC_EMAIL_SEND_IN,
				   ENROLL_SUC_EMAIL_TMPLT_ID, ENROLL_STA_EMAIL_SEND_IN,
				   ENROLL_STA_EMAIL_TMPLT_ID, CMPGN_IM_URL_AD_TX,
				   EMS_EXTNL_PROMO_ID, EMS_EXTNL_PRTR_ID, CMPGN_LIVE_DT
			FROM tgabm00.GABM_CMPGN
			WHERE CMPGN_STRT_DT >= IN_CMPGN_STRT_DT
			  AND CMPGN_END_DT <= IN_CMPGN_END_DT;
		EXCEPTION
			WHEN OTHERS THEN
				SQLCODE := SQLSTATE;
				RESP_CD := 'E35174903';
				RESP_MSG := 'THE SYSTEM CANNOT PROCESS YOUR REQUEST. PLEASE TRY AFTER SOME TIME.';
				SQLCODE_PARM := SQLCODE;
				RETURN QUERY SELECT SQLCODE_PARM, RESP_CD, RESP_MSG, NULL::CHAR(25), NULL::CHAR(100), NULL::TEXT, NULL::CHAR(10), NULL::TEXT, NULL::TIMESTAMP, NULL::TIMESTAMP, NULL::INTEGER, NULL::INTEGER, NULL::TEXT, NULL::DATE, NULL::DATE, NULL::DATE, NULL::TEXT, NULL::TEXT, NULL::CHAR(1), NULL::CHAR(10), NULL::CHAR(1), NULL::CHAR(10), NULL::TEXT, NULL::CHAR(10), NULL::CHAR(10), NULL::DATE;
		END;
	ELSIF IN_FETCH_IND = 'ACTCMPGN' THEN
		BEGIN
			SQLCODE := '0';
			RESP_CD := 'E35174005';
			RESP_MSG := 'ACTIVE CMPGN DETAIL FETCH SUCCESSFULLY.';
			SQLCODE_PARM := SQLCODE;
			RETURN QUERY
			SELECT SQLCODE_PARM, RESP_CD, RESP_MSG, CMPGN_ID, CMPGN_NM, CMPGN_DS, CMPGN_PROMO_CD, CMPGN_STA_TX,
				   CREAT_TS, LST_UPDT_TS, CMPGN_CONTEST_MAX_ENTER_CT,
				   CMPGN_TRGT_REGIS_CT, BUS_PRTR_DRCT_OWN_NM, CMPGN_STRT_DT,
				   CMPGN_END_DT, DA_PRG_DT, CREAT_BY_USER_TYPE_TX,
				   UPDT_BY_USER_TYPE_TX, ENROLL_SUC_EMAIL_SEND_IN,
				   ENROLL_SUC_EMAIL_TMPLT_ID, ENROLL_STA_EMAIL_SEND_IN,
				   ENROLL_STA_EMAIL_TMPLT_ID, CMPGN_IM_URL_AD_TX,
				   EMS_EXTNL_PROMO_ID, EMS_EXTNL_PRTR_ID, CMPGN_LIVE_DT
			FROM tgabm00.GABM_CMPGN
			WHERE CMPGN_END_DT >= CURRENT_DATE;
		EXCEPTION
			WHEN OTHERS THEN
				SQLCODE := SQLSTATE;
				RESP_CD := 'E35174905';
				RESP_MSG := 'THE SYSTEM CANNOT PROCESS YOUR REQUEST. PLEASE TRY AFTER SOME TIME.';
				SQLCODE_PARM := SQLCODE;
				RETURN QUERY SELECT SQLCODE_PARM, RESP_CD, RESP_MSG, NULL::CHAR(25), NULL::CHAR(100), NULL::TEXT, NULL::CHAR(10), NULL::TEXT, NULL::TIMESTAMP, NULL::TIMESTAMP, NULL::INTEGER, NULL::INTEGER, NULL::TEXT, NULL::DATE, NULL::DATE, NULL::DATE, NULL::TEXT, NULL::TEXT, NULL::CHAR(1), NULL::CHAR(10), NULL::CHAR(1), NULL::CHAR(10), NULL::TEXT, NULL::CHAR(10), NULL::CHAR(10), NULL::DATE;
		END;
	ELSE
		SQLCODE := '0';
		RESP_CD := 'E35174104';
		RESP_MSG := 'INVALID SEARCH PARAMETER.';
		SQLCODE_PARM := SQLCODE;
		RETURN QUERY SELECT SQLCODE_PARM, RESP_CD, RESP_MSG, NULL::CHAR(25), NULL::CHAR(100), NULL::TEXT, NULL::CHAR(10), NULL::TEXT, NULL::TIMESTAMP, NULL::TIMESTAMP, NULL::INTEGER, NULL::INTEGER, NULL::TEXT, NULL::DATE, NULL::DATE, NULL::DATE, NULL::TEXT, NULL::TEXT, NULL::CHAR(1), NULL::CHAR(10), NULL::CHAR(1), NULL::CHAR(10), NULL::TEXT, NULL::CHAR(10), NULL::CHAR(10), NULL::DATE;
	END IF;
EXCEPTION
	WHEN OTHERS THEN
		SQLCODE := SQLSTATE;
		RESP_CD := 'E35174999';
		RESP_MSG := 'UNEXPECTED ERROR OCCURRED.';
		SQLCODE_PARM := SQLCODE;
		RETURN QUERY SELECT SQLCODE_PARM, RESP_CD, RESP_MSG, NULL::CHAR(25), NULL::CHAR(100), NULL::TEXT, NULL::CHAR(10), NULL::TEXT, NULL::TIMESTAMP, NULL::TIMESTAMP, NULL::INTEGER, NULL::INTEGER, NULL::TEXT, NULL::DATE, NULL::DATE, NULL::DATE, NULL::TEXT, NULL::TEXT, NULL::CHAR(1), NULL::CHAR(10), NULL::CHAR(1), NULL::CHAR(10), NULL::TEXT, NULL::CHAR(10), NULL::CHAR(10), NULL::DATE;
END;
