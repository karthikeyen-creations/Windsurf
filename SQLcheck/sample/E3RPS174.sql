--#SET TERMINATOR #
DROP PROCEDURE SYSPROC.E3RPS174 #
CREATE PROCEDURE SYSPROC.E3RPS174
(
IN IN_CMPGN_ID CHAR(25)
,IN IN_CMPGN_NM CHAR(100)
,IN IN_CMPGN_STRT_DT DATE
,IN IN_CMPGN_END_DT DATE 
,IN IN_FETCH_IND CHAR(10)
,OUT SQLCODE_PARM CHAR(10)
,OUT RESP_CD CHAR(14)
,OUT RESP_MSG CHAR(100)
)
DYNAMIC RESULT SETS 1
WITH EXPLAIN
VALIDATE BIND
PACKAGE OWNER PRODSUPT
QUALIFIER VMUS00
LANGUAGE SQL
MODIFIES SQL DATA
CALLED ON NULL INPUT
COMMIT ON RETURN NO
ASUTIME LIMIT 7500000
INHERIT SPECIAL REGISTERS
NOT DETERMINISTIC
DISABLE DEBUG MODE
PA:BEGIN
DECLARE SQLCODE INTEGER;
DECLARE HV_CMPGN_NM VARCHAR(100);
DECLARE HV_CMPGN_NM1 VARCHAR(100);
DECLARE EXIT HANDLER FOR SQLEXCEPTION

BEGIN
SET SQLCODE_PARM = SQLCODE;
SET RESP_CD ='E35174999';

SET RESP_MSG = 'SQL EXCEPTION.CHECK SQLCODE TO FIX.';
END;
SET SQLCODE_PARM ='';
SET RESP_CD ='';SET RESP_MSG  ='';

IF IN_FETCH_IND = 'CMPGNID' THEN

CSR1:BEGIN

DECLARE CSR1 CURSOR WITH RETURN TO CALLER FOR

SELECT CMPGN_ID, CMPGN_NM, CMPGN_DS, CMPGN_PROMO_CD, CMPGN_STA_TX
,CREAT_TS, LST_UPDT_TS, CMPGN_CONTEST_MAX_ENTER_CT,
CMPGN_TRGT_REGIS_CT, BUS_PRTR_DRCT_OWN_NM, CMPGN_STRT_DT,
CMPGN_END_DT, DA_PRG_DT, CREAT_BY_USER_TYPE_TX,
UPDT_BY_USER_TYPE_TX, ENROLL_SUC_EMAIL_SEND_IN,
ENROLL_SUC_EMAIL_TMPLT_ID, ENROLL_STA_EMAIL_SEND_IN,
ENROLL_STA_EMAIL_TMPLT_ID, CMPGN_IM_URL_AD_TX,
EMS_EXTNL_PROMO_ID, EMS_EXTNL_PRTR_ID,CMPGN_LIVE_DT

FROM GABM_CMPGN

WHERE CMPGN_ID = IN_CMPGN_ID

WITH UR;
OPEN CSR1;
CASE
WHEN SQLCODE ='0' THEN
SET RESP_CD = 'E35174001';

SET RESP_MSG = 'CMPGN ID DETAIL FETCH SUCCESSFULLY.';

SET SQLCODE_PARM = SQLCODE;

LEAVE P1;

WHEN SQLCODE <> 0 THEN
SET RESP_CD ='E35174901';
SET RESP_MSG = 'THE SYSTEM CANNOT PROCESS YOUR REQUEST.
PLEASE TRY AFTER SOME TIME.';
SET SQLCODE_PARM = SQLCODE;
LEAVE P1;
END CASE;

END CSR1;
ENDIF;

IF IN_FETCH_IND = 'CMPGNNM' THEN

SET HV_CMPGN_NM = '%' || STRIP(IN_CMPGN_NM,LEADING) ;

SET HV_CMPGN_NM1 = STRIP(HV_CMPGN_NM,TRAILING) || '%' ;

CSR2:BEGIN

DECLARE CSR2 CURSOR WITH RETURN TO CALLER FOR

SELECT CMPGN_ID, CMPGN_NM, CMPGN_DS, CMPGN_PROMO_CD, CMPGN_STA_TX
,CREAT_TS, LST_UPDT_TS, CMPGN_CONTEST_MAX_ENTER_CT,
CMPGN_TRGT_REGIS_CT, BUS_PRTR_DRCT_OWN_NM, CMPGN_STRT_DT,
CMPGN_END_DT, DA_PRG_DT, CREAT_BY_USER_TYPE_TX,
UPDT_BY_USER_TYPE_TX, ENROLL_SUC_EMAIL_SEND_IN,
ENROLL_SUC_EMAIL_TMPLT_ID, ENROLL_STA_EMAIL_SEND_IN,
ENROLL_STA_EMAIL_TMPLT_ID, CMPGN_IM_URL_AD_TX,
EMS_EXTNL_PROMO_ID, EMS_EXTNL_PRTR_ID,CMPGN_LIVE_DT

FROM GABM_CMPGN

WHERE UPPER(CMPGN_NM) LIKE UPPER(HV_CMPGN_NM1)
WITH UR;

OPEN CSR2;

CASE
WHEN SQLCODE = '0' THEN
SET RESP_CD ='E35174002';
SET RESP_MSG = 'CMPGN NM DETAIL FETCH SUCCESSFULLY. ';
SET SQLCODE_PARM = SQLCODE;
LEAVE P1;

WHEN SQLCODE <> 0 THEN
SET RESP_CD = 'E35174902';
SET RESP_MSG = 'THE SYSTEM CANNOT PROCESS YOUR REQUEST. PLEASE TRY AFTER SOME TIME.';
SET SQLCODE_PARM = SQLCODE;
LEAVE P1;
END CASE;
END CSR2;
END IF;

IF IN_FETCH_IND = 'CMPGNDT' THEN CSR3:BEGIN
DECLARE CSR3 CURSOR WITH RETURN TO CALLER FOR
SELECT CMPGN_ID, CMPGN_NM, CMPGN_DS, CMPGN_PROMO_CD, CMPGN_STA_TX
,CREAT_TS, LST_UPDT_TS, CMPGN_CONTEST_MAX_ENTER_CT,
CMPGN_TRGT_REGIS_CT, BUS_PRTR_DRCT_OWN_NM, CMPGN_STRT_DT,
CMPGN_END_DT, DA_PRG_DT, CREAT_BY_USER_TYPE_TX,
UPDT_BY_USER_TYPE_TX, ENROLL_SUC_EMAIL_SEND_IN,
ENROLL_SUC_EMAIL_TMPLT_ID, ENROLL_STA_EMAIL_SEND_IN,
ENROLL_STA_EMAIL_TMPLT_ID, CMPGN_IM_URL_AD_TX,
EMS_EXTNL_PROMO_ID, EMS_EXTNL_PRTR_ID, CMPGN_LIVE_DT
FROM GABM_CMPGN
WHERE CMPGN_STRT_DT >= IN_CMPGN_STRT_DT
AND CMPGN_END_DT <= IN_CMPGN_END_DT
WITH UR;

OPEN CSR3;

CASE
WHEN SQLCODE ='0' THEN
SET RESP_CD = 'E35174003';
SET RESP_MSG = 'CMPGN DETAIL FETCH SUCCESSFULLY. ';
SET SQLCODE_PARM = SQLCODE;

LEAVE P1;
WHEN SQLCODE <> 0 THEN
SET RESP_CD ='E35174903';

SET RESP_MSG = 'THE SYSTEM CANNOT PROCESS YOUR REQUEST. PLEASE TRY AFTER SOME TIME';
SET SQLCODE_PARM = SQLCODE;
LEAVE P1;
END CASE;
END CSR3;
END IF;

IF IN_FETCH_IND = 'ACTCMPGN' THEN

CSR4:BEGIN

DECLARE CSR4 CURSOR WITH RETURN TO CALLER FOR

SELECT CMPGN_ID, CMPGN_NM, CMPGN_DS, CMPGN_PROMO_CD, CMPGN_STA_TX
,CREAT_TS, LST_UPDT_TS, CMPGN_CONTEST_MAX_ENTER_CT,
CMPGN_TRGT_REGIS_CT, BUS_PRTR_DRCT_OWN_NM, CMPGN_STRT_DT,
CMPGN_END_DT, DA_PRG_DT, CREAT_BY_USER_TYPE_TX,
UPDT_BY_USER_TYPE_TX, ENROLL_SUC_EMAIL_SEND_IN,
ENROLL_SUC_EMAIL_TMPLT_ID, ENROLL_STA_EMAIL_SEND_IN,
ENROLL_STA_EMAIL_TMPLT_ID, CMPGN_IM_URL_AD_TX,
EMS_EXTNL_PROMO_ID, EMS_EXTNL_PRTR_ID, CMPGN_LIVE_DT

FROM GABM_CMPGN

WHERE CMPGN_END_DT >= CURRENT_DATE
WITH UR;

OPEN CSR4;

CASE
WHEN SQLCODE ='0' THEN
SET RESP_CD ='E35174005';
SET RESP_MSG = 'ACTIVE CMPGN DETAIL FETCH SUCCESSFULLY. ';
SET SQLCODE_PARM = SQLCODE;
LEAVE P1;
WHEN SQLCODE <> 0 THEN
SET RESP_CD = 'E35174905';
SET RESP_MSG = 'THE SYSTEM CANNOT PROCESS YOUR REQUEST. PLEASE TRY AFTER SOME TIME.';
SET SQLCODE_PARM = SQLCODE;
LEAVE P1;
END CASE;
END CSR4;
ENDIF;

SET RESP_CD ='E35174104';

SET RESP_MSG = 'INVALID SEARCH PARAMETER.';
SET SQLCODE_PARM = 0;

LEAVE P1;

END P1#
GRANT EXECUTE ON PROCEDURE SYSPROC.E3RP5174 TO
XB1459A, XB3375A, XB1916A, XB1914A, XB2347A, JO81SE, JO810MS #